<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualisation des DÃ©penses - Chart.js</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f7f7f7; }
        h1, h2 { text-align: center; color: #0056b3; }
        
        .chart-container {
            width: 95%;
            max-width: 1000px;
            margin: 20px auto;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            /* Hauteur minimale pour Ã©viter l'Ã©crasement sur mobile */
            min-height: 300px; 
            position: relative;
        }

        /* --- STYLE POUR L'ALERTE MOBILE --- */
        .landscape-alert {
            display: none; /* CachÃ© par dÃ©faut */
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
            padding: 15px;
            text-align: center;
            border-radius: 5px;
            margin-bottom: 20px;
            font-weight: bold;
            font-size: 1.1em;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* Afficher l'alerte uniquement sur les Ã©crans < 768px (mobiles) et en mode portrait */
        @media only screen and (max-width: 768px) and (orientation: portrait) {
            .landscape-alert {
                display: block;
                animation: pulse 2s infinite;
            }
        }

        /* Petite animation pour attirer l'attention */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>

    <!-- MESSAGE D'ALERTE MOBILE -->
    <div class="landscape-alert">
        ðŸ“±ðŸ”„ Pour mieux voir les graphiques, veuillez tourner votre appareil en mode paysage !
    </div>

    <h1>Ã‰volution des DÃ©penses</h1>
    
    <div class="chart-container">
        <h2>1. Total des DÃ©penses ðŸ’°</h2>
        <!-- Ajout d'une hauteur relative pour mobile -->
        <div style="position: relative; height: 60vh; max-height: 400px;">
            <canvas id="graphiqueTotal"></canvas>
        </div>
    </div>

    <div class="chart-container">
        <h2>2. DÃ©penses par CatÃ©gorie ðŸ“Š</h2>
        <div style="position: relative; height: 60vh; max-height: 400px;">
            <canvas id="graphiqueCategories"></canvas>
        </div>
    </div>

    <script>
        // ====================================================================
        // DONNÃ‰ES JSON 
        // ====================================================================

        const TOTAL_DEPENSES_MENSUELLES_JSON = [
            {"mois": "AoÃ»t 2024", "total": 151828.00},
            {"mois": "Septembre 2024", "total": 153199.00},
            {"mois": "Octobre 2024", "total": 155664.00},
            {"mois": "Novembre 2024", "total": 174278.00},
            {"mois": "DÃ©cembre 2024", "total": 167068.50},
            {"mois": "Janvier 2025", "total": 172860.00},
            {"mois": "FÃ©vrier 2025", "total": 155210.00},
            {"mois": "Mars 2025", "total": 87625.50},
            {"mois": "Avril 2025", "total": 219032.50},
            {"mois": "Mai 2025", "total": 182100.50},
            {"mois": "Juin 2025", "total": 165802.00},
            {"mois": "Juillet 2025", "total": 212220.50},
            {"mois": "AoÃ»t 2025", "total": 206373.00},
            {"mois": "Septembre 2025", "total": 187690.00},
            {"mois": "Octobre 2025", "total": 222893.00},
            {"mois": "Novembre 2025", "total": 175528.00}
        ];

        const DEPENSES_PAR_CATEGORIES_JSON = [
            {"mois": "AoÃ»t 2024", "ABDELILAH": 35816.00, "LAAMARTI": 12900.00, "POULET": 19500.00, "POISSON/FRITES": 9200.00, "LÃ‰GUMES": 10200.00, "FRUITS": 10000.00, "PERSONNEL": 20000.00, "EMBALLAGES": 7500.00},
            {"mois": "Septembre 2024", "ABDELILAH": 26224.00,"LAAMARTI": 13100.00, "POULET": 19900.00, "POISSON/FRITES": 9300.00, "LÃ‰GUMES": 10300.00, "FRUITS": 10100.00, "PERSONNEL": 20000.00, "EMBALLAGES": 7500.00},
            {"mois": "Octobre 2024", "ABDELILAH": 36502.00, "LAAMARTI": 13300.00, "POULET": 20300.00, "POISSON/FRITES": 9400.00, "LÃ‰GUMES": 10400.00, "FRUITS": 10200.00, "PERSONNEL": 20000.00, "EMBALLAGES": 7500.00},
            {"mois": "Novembre 2024", "ABDELILAH": 35304.00, "LAAMARTI": 13500.00, "POULET": 20700.00, "POISSON/FRITES": 9500.00, "LÃ‰GUMES": 10500.00, "FRUITS": 10300.00, "PERSONNEL": 20000.00, "EMBALLAGES": 7500.00},
            {"mois": "DÃ©cembre 2024", "ABDELILAH": 39658.00, "LAAMARTI": 13700.00, "POULET": 21100.00, "POISSON/FRITES": 9600.00, "LÃ‰GUMES": 10600.00, "FRUITS": 10400.00, "PERSONNEL": 20000.00, "EMBALLAGES": 7500.00},
            {"mois": "Janvier 2025","ABDELILAH": 42171.00, "LAAMARTI": 13900.00, "POULET": 21500.00, "POISSON/FRITES": 9700.00, "LÃ‰GUMES": 10700.00, "FRUITS": 10500.00, "PERSONNEL": 20000.00, "EMBALLAGES": 7500.00},
            {"mois": "FÃ©vrier 2025", "ABDELILAH": 20564.00,"LAAMARTI": 14100.00, "POULET": 21900.00, "POISSON/FRITES": 9800.00, "LÃ‰GUMES": 10800.00, "FRUITS": 10600.00, "PERSONNEL": 20000.00, "EMBALLAGES": 7500.00},
            {"mois": "Mars 2025", "ABDELILAH": 18660.00, "LAAMARTI": 14300.00, "POULET": 22300.00, "POISSON/FRITES": 9900.00, "LÃ‰GUMES": 10900.00, "FRUITS": 10700.00, "PERSONNEL": 20000.00, "EMBALLAGES": 7500.00},
            {"mois": "Avril 2025", "ABDELILAH": 51371.00,"LAAMARTI": 14500.00, "POULET": 22700.00, "POISSON/FRITES": 10000.00, "LÃ‰GUMES": 11000.00, "FRUITS": 10800.00, "PERSONNEL": 20000.00, "EMBALLAGES": 7500.00},
            {"mois": "Mai 2025", "ABDELILAH": 40641.00, "LAAMARTI": 15000.00, "POULET": 23100.00, "POISSON/FRITES": 10100.00, "LÃ‰GUMES": 11200.00, "FRUITS": 11100.00, "PERSONNEL": 20000.00, "EMBALLAGES": 7500.00},
            {"mois": "Juin 2025", "ABDELILAH": 41439.00,"LAAMARTI": 15200.00, "POULET": 23500.00, "POISSON/FRITES": 10200.00, "LÃ‰GUMES": 11400.00, "FRUITS": 11300.00, "PERSONNEL": 20000.00, "EMBALLAGES": 7500.00},
            {"mois": "Juillet 2025", "ABDELILAH": 47447.00,"LAAMARTI": 15480.00, "POULET": 23990.00, "POISSON/FRITES": 10400.00, "LÃ‰GUMES": 11600.00, "FRUITS": 11500.00, "PERSONNEL": 20000.00, "EMBALLAGES": 7500.00},
            {"mois": "AoÃ»t 2025", "ABDELILAH": 47187.00,"LAAMARTI": 15678.00, "POULET": 24120.00, "POISSON/FRITES": 10500.00, "LÃ‰GUMES": 11800.00, "FRUITS": 11700.00, "PERSONNEL": 20000.00, "EMBALLAGES": 7500.00},
            {"mois": "Septembre 2025", "ABDELILAH": 39795.00, "LAAMARTI": 15890.00, "POULET": 24560.00, "POISSON/FRITES": 10540.00, "LÃ‰GUMES": 12010.00, "FRUITS": 11880.00, "PERSONNEL": 20000.00, "EMBALLAGES": 7500.00},
            {"mois": "Octobre 2025","ABDELILAH": 49655.00, "LAAMARTI": 15545.00, "POULET": 24987.00, "POISSON/FRITES": 10980.00, "LÃ‰GUMES": 12210.00, "FRUITS": 11980.00, "PERSONNEL": 20000.00, "EMBALLAGES": 7500.00},
            {"mois": "Novembre 2025", "ABDELILAH": 32887.00,"LAAMARTI": 16014.50, "POULET": 25385.00, "POISSON/FRITES": 11021.00, "LÃ‰GUMES": 12581.50, "FRUITS": 12110.50, "PERSONNEL": 20000.00, "EMBALLAGES": 7500.00}
        ];

        // ====================================================================
        // CONFIGURATION
        // ====================================================================

        // Options communes pour que le graphique s'adapte au conteneur HTML
        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false, // Permet au graphique de remplir la hauteur dÃ©finie dans le CSS
            plugins: {
                legend: { position: 'bottom' }
            }
        };
        
        function createTotalExpensesChart() {
            const dataJson = TOTAL_DEPENSES_MENSUELLES_JSON;
            const labels = dataJson.map(item => item.mois.replace(' ', '\n')); 
            const dataValues = dataJson.map(item => item.total);

            const ctx = document.getElementById('graphiqueTotal').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Total',
                        data: dataValues,
                        backgroundColor: dataValues.map(val => (val === 175528.00 ? 'rgba(255, 99, 132, 0.8)' : 'rgba(75, 192, 192, 0.7)')),
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    ...commonOptions,
                    scales: {
                        y: { beginAtZero: false }
                    }
                }
            });
        }

        function createCategoryExpensesChart() {
            const categoryJson = DEPENSES_PAR_CATEGORIES_JSON;
            const categories = Object.keys(categoryJson[0]).filter(key => key !== 'mois');
            const categoryLabels = categoryJson.map(item => item.mois.replace(' ', '\n'));

            const colors = {
                'ABDELILAH': '#007bff', 'LAAMARTI': '#FF6384', 'POULET': '#FF9F40', 
                'POISSON/FRITES': '#4BC0C0', 'LÃ‰GUMES': '#9966FF', 'FRUITS': '#36A2EB', 
                'PERSONNEL': '#28a745', 'EMBALLAGES': '#6c757d'
            };

            const datasets = categories.map(cat => ({
                label: cat,
                data: categoryJson.map(item => item[cat]),
                borderColor: colors[cat] || '#333',
                backgroundColor: colors[cat] || '#333',
                fill: false,
                tension: 0.3,
                pointRadius: 2 
            }));

            const ctx2 = document.getElementById('graphiqueCategories').getContext('2d');
            new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: categoryLabels,
                    datasets: datasets
                },
                options: {
                    ...commonOptions,
                    scales: {
                        y: { beginAtZero: false }
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            createTotalExpensesChart();
            createCategoryExpensesChart();
        });

    </script>
</body>
</html>
